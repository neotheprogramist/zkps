# Setting up env

ZKLLVM binaries are released only for the debian based systems. They can be build from source, but this process needs additional configuration of both source files (CMAKE files), as well as system.

Because of this I created a dockerfile and dev container that is much more pleasant to use.

## Development in a dev container

If using VSCode and in this `/zkllvm` directory you can work inside a docker by choosing `reopen in container` option in the command palette (F1).

Then you can run `./entrypoint` to generate circuit, proof and verifier.

## Manual development

1. To compile a circuit

```bash
cargo +zkllvm build --release --target assigner-unknown-unknown --features=zkllvm
```

2. To assign inputs to circuit

```bash
assigner -b target/assigner-unknown-unknown/release/zkllvm-rust-template.ll -i inputs/example.inp -t assignment.tbl -c circuit.crct -e pallas
```

3. To generate a proof

```bash
proof-generator-multi-threaded --circuit circuit.crct --assignment assignment.tbl --proof proof.bin

```

4. To verify the proof

```bash
proof-generator-multi-threaded --verification-only --circuit circuit.crct --assignment assignment.tbl --proof proof.bin
```

4. To generate a solidity verifier

```bash
transpiler -m gen-evm-verifier -c circuit.crct -t assignment.tbl -o verifier -e pallas
```

## Development with docker (without devcontainer)

Docker serializes all needed generated files and outputs them on the standard output. It can be run end extracted using

```bash
podman build -t zkllvm . && podman run zkllvm:latest | tar -xzv
```

## Solidity verifier

The Solidity files generated by the `transpiler` program reference outside libraries from this repository: https://github.com/NilFoundation/evm-placeholder-verification.
To run verifier copy the `verifier` folder from this repository to `contracts/zkllvm`. Include `proof.bin` and create a `public_input.inp` in the `verifier` directory.

Fill the `public_input.inp` file with serialized input from file `inputs/example.inp`. For example

```json
[
  {
    "field": 5
  },
  {
    "field": 11
  }
]
```

would need to be written as

```plain
5
11
```

Then run the command below to check validity of the proof

```bash
npx hardhat verify-circuit-proof --test verifier
```
